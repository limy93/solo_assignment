{% extends "base.html" %}

{% block title %}{{ product.country.country_name }} Details{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card mb-4 shadow">
        <div class="card-header text-center">
            <h2>{{ product.country.country_name }} Details</h2>
        </div>
        <div class="card-body">
            <h5 class="card-title">{{ product.country.country_name }}</h5>
            <p class="card-text">Country Code: {{ product.country.country_code }}</p>
            <p class="card-text">Long Name: {{ product.country.metadata.long_name }}</p>
            <p class="card-text">Region: {{ product.country.metadata.region }}</p>
            <p class="card-text">Currency Unit: {{ product.country.metadata.currency_unit }}</p>
            <p class="card-text">Income Group: {{ product.country.metadata.income_group }}</p>
            <p class="card-text">Special Notes: {{ product.country.metadata.special_notes }}</p>
            <p class="card-text"><strong>Price: ${{ product.price }}</strong></p>
        </div>

        {% if electric_data %}
        <div class="card-body">
            <h4 class="text-center mb-3">Electric Power Consumption from 1994 to 2014 (kWh per Capita)</h4>
            <canvas id="electricConsumptionChart"></canvas>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var ctx = document.getElementById('electricConsumptionChart').getContext('2d');
                var electricConsumptionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: {{ years|safe }},
                        datasets: [{
                            label: 'Electric Power Consumption (kWh per Capita, Yearly)',
                            data: {{ electric_data|safe }},
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Electric Power Consumption (kWh per Capita)',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    },
                                    padding: 5
                                },
                                beginAtZero: true
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Year',
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        }
                    }
                });
            });
        </script>
        {% else %}
        <div class="card-body">
            <p>No electric power consumption data available.</p>
        </div>
        {% endif %}
        <div class="card-footer text-center bg-light">
            <form action="{% url 'add_to_cart' product.id %}" method="post" class="d-flex justify-content-center align-items-center">
                {% csrf_token %}
                <div class="mr-2">
                    <label for="quantity" class="form-label">Quantity:</label>
                    <input type="number" id="quantity" name="quantity" value="1" min="1" class="form-control" style="width: 100px; display: inline-block;">
                </div>
                <button type="submit" class="btn btn-primary mr-2">Add to Cart</button>
                <a href="{% url 'list_products' %}" class="btn btn-secondary">Back to Product List</a>
            </form
        </div>
    </div>
</div>
{% endblock %}